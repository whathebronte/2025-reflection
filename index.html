<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflection Deck</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for 3D flipping and mobile layout */
        .perspective-container {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
        }
        .card-inner {
            transition: transform 700ms ease-in-out;
        }
        /* Hide scrollbar for question text */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">
        <!-- Main Card Container -->
        <main class="w-full max-w-md relative flex flex-col items-center justify-center perspective-container">
            
            <div id="card-tap-area" class="relative w-full aspect-[3/4] max-h-[70vh] cursor-pointer group">
                <div id="card-inner" class="card-inner w-full h-full relative transform-style-3d">
                    
                    <!-- FACE 1 (Front, 0, 360, 720...) - Title OR Question A -->
                    <div id="face-a" class="absolute inset-0 w-full h-full bg-[#B91C1C] rounded-2xl shadow-2xl flex flex-col items-center justify-center p-8 backface-hidden border-[6px] border-white/10 select-none">
                        <div class="border border-white/20 absolute inset-4 rounded-xl pointer-events-none"></div>
                        <div id="content-a" class="w-full h-full flex items-center justify-center overflow-y-auto scrollbar-hide text-center">
                            <!-- Title Content -->
                            <div id="title-content-a" class="space-y-2">
                                <h1 class="text-5xl font-black text-white tracking-tighter leading-none">REFLECT<br/>2025</h1>
                                <p id="tap-message-a" class="text-red-200 text-sm font-bold tracking-widest uppercase mt-6">Tap to Begin</p>
                            </div>
                            <!-- Question Content (Hidden by default) -->
                            <h2 id="question-text-a" class="text-3xl font-bold text-white text-center leading-snug hidden"></h2>
                        </div>
                        <div id="deck-status-a" class="absolute bottom-8 text-red-300 text-xs font-bold tracking-widest uppercase opacity-70"></div>
                    </div>

                    <!-- FACE 2 (Back, 180, 540, 900...) - Question B -->
                    <div id="face-b" class="absolute inset-0 w-full h-full bg-[#B91C1C] rounded-2xl shadow-2xl flex flex-col items-center justify-center p-8 backface-hidden border-[6px] border-white/10 select-none" style="transform: rotateY(180deg);">
                        <div class="border border-white/20 absolute inset-4 rounded-xl pointer-events-none"></div>
                        <div id="content-b" class="w-full h-full flex items-center justify-center overflow-y-auto scrollbar-hide">
                            <h2 id="question-text-b" class="text-3xl font-bold text-white text-center leading-snug"></h2>
                        </div>
                        <div id="deck-status-b" class="absolute bottom-8 text-red-300 text-xs font-bold tracking-widest uppercase opacity-70"></div>
                    </div>
                </div>
            </div>

            <!-- Finished State View -->
            <div id="finished-state" class="absolute inset-0 flex flex-col items-center justify-center text-center z-20 hidden">
                <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-xs w-full animate-in">
                    <!-- Removed Sparkles Icon. Added margin-top to keep layout similar. -->
                    <h2 class="text-2xl font-black text-gray-900 mb-2 mt-4">COMPLETE</h2>
                    <p class="text-gray-500 mb-6 text-sm">You've reflected on everything.</p>
                    <button id="restart-button" class="w-full py-3 bg-red-700 hover:bg-red-800 text-white font-bold rounded-lg transition-colors flex items-center justify-center">
                        Shuffle & Restart
                    </button>
                </div>
            </div>
        </main>

        <!-- New Subtle Restart Button -->
        <button id="subtle-restart-button" class="mt-8 text-gray-400 hover:text-red-500 transition-colors hidden text-sm font-semibold tracking-wide opacity-80">
            Restart Deck
        </button>
    </div>

    <script>
        const INITIAL_QUESTIONS = [
            "What did I change my mind on this year?",
            "What created energy this year?",
            "What drained energy this year?",
            "What did I not do because of fear?",
            "What were my greatest hits & worst misses?",
            "What did I learn this year?",
            "What was the single biggest surprise of the year?",
            "What habit am I most proud of starting or breaking?",
            "What simple pleasure did I appreciate the most this year?",
            "What is a mistake I made that I don't regret?",
            "What advice would my past self be proud of me for taking?",
            "What skill or piece of knowledge became most useful to me this year?",
            "What challenged me the most this year?",
            "What boundary did I set (or fail to set)?",
            "What is the one thing I need to forgive myself (or someone else) for to move forward?",
            "What am I most proud of this year?",
            "What am I most thankful for this year?",
            "What advice would I give my future self?",
        ];

        // Constants
        const FLIP_DURATION = 700; // ms
        const HALFWAY_POINT = FLIP_DURATION / 2; // ms

        // DOM Elements
        const cardInner = document.getElementById('card-inner');
        const tapArea = document.getElementById('card-tap-area');
        const finishedState = document.getElementById('finished-state');
        const restartButton = document.getElementById('restart-button');
        const subtleRestartButton = document.getElementById('subtle-restart-button');
        
        // Face A Elements
        const titleContentA = document.getElementById('title-content-a');
        const questionTextA = document.getElementById('question-text-a');
        const deckStatusA = document.getElementById('deck-status-a');
        
        // Face B Elements
        const questionTextB = document.getElementById('question-text-b');
        const deckStatusB = document.getElementById('deck-status-b');

        // State Variables
        let rotationY = 0; 
        let deck = [...INITIAL_QUESTIONS];
        let isAnimating = false;
        let gameStatus = 'start'; // start, active, finished
        let questionA = null;
        let questionB = null;

        // --- Core Functions ---

        const updateDeckStatus = () => {
            const currentCardNumber = INITIAL_QUESTIONS.length - deck.length;
            const totalCards = INITIAL_QUESTIONS.length;
            
            // The status bar text remains the same (showing remaining count)
            const statusText = gameStatus === 'start' 
                ? `${totalCards} CARDS`
                : `CARD ${currentCardNumber}/${totalCards}`;
            
            // Set for both faces as they are hidden/visible alternately
            deckStatusA.textContent = statusText;
            deckStatusB.textContent = statusText;

            // Show subtle restart button only when active
            if (gameStatus === 'active') {
                subtleRestartButton.classList.remove('hidden');
            } else {
                subtleRestartButton.classList.add('hidden');
            }
        };

        const drawNextQuestion = (isSettingA) => {
            if (deck.length === 0) {
                return null;
            }

            const randomIndex = Math.floor(Math.random() * deck.length);
            const selected = deck[randomIndex];
            
            // Update the deck state
            deck = deck.filter((_, index) => index !== randomIndex);
            
            if (isSettingA) {
                questionA = selected;
                questionTextA.textContent = selected;
            } else {
                questionB = selected;
                questionTextB.textContent = selected;
            }
            
            updateDeckStatus();
            return selected;
        };
        
        const renderCardContent = (isFaceAVisible) => {
            // This function swaps the DOM elements to show either Title or Question
            if (isFaceAVisible) {
                if (gameStatus === 'start') {
                    // Show Title on Face A
                    titleContentA.style.display = 'block';
                    questionTextA.style.display = 'none';
                } else {
                    // Show Question A on Face A
                    titleContentA.style.display = 'none';
                    questionTextA.style.display = 'block';
                    questionTextA.textContent = questionA || ''; // Clear text if null
                }
            }
            // Face B is always a Question Face
            questionTextB.textContent = questionB || ''; // Clear text if null
        };


        const transitionToFinished = () => {
            gameStatus = 'finished';
            tapArea.style.opacity = '0';
            tapArea.style.transform = 'scale(0.9)';
            tapArea.style.pointerEvents = 'none';
            finishedState.classList.remove('hidden');
            subtleRestartButton.classList.add('hidden'); // Hide subtle button when finished screen is up
        };

        const handleCardTap = () => {
            if (isAnimating || gameStatus === 'finished') return;
            isAnimating = true;

            const isFaceAVisible = rotationY % 360 === 0;
            const nextRotation = rotationY + 180;
            
            if (gameStatus === 'start') {
                // --- 1. INITIAL START: Flip from Title (Face A) to Q1 (Face B) ---
                
                if (deck.length === 0) {
                    transitionToFinished();
                    isAnimating = false;
                    return;
                }

                gameStatus = 'active';
                
                // Draw Q1 content into the HIDDEN slot (Face B)
                drawNextQuestion(false); 
                
                // Show Question on Face B
                renderCardContent(isFaceAVisible);
                updateDeckStatus(); // Refresh status to show card count and subtle button

                // Flip 180 deg (0 -> 180) to show Face B
                rotationY = 180;
                cardInner.style.transform = `rotateY(${rotationY}deg)`;
                
                setTimeout(() => {
                    isAnimating = false;
                }, FLIP_DURATION);
                return;
            }
            
            // --- 2. ACTIVE FLOW: Seamless flip Qn -> Qn+1 OR Q_Last -> Finish ---
            
            // Check for finish *before* starting the flip
            if (deck.length === 0) {
                // === LAST QUESTION TAPPED: Flip to blank card and transition to COMPLETE ===
                
                // 1. Start the flip to the final position
                rotationY = nextRotation; 
                cardInner.style.transform = `rotateY(${rotationY}deg)`;

                // 2. Immediately clear content so the final face is blank red
                questionA = null;
                questionB = null;
                renderCardContent(isFaceAVisible); // Renders cleared content
                
                // 3. Wait for the flip to finish, then transition to finished screen
                setTimeout(transitionToFinished, FLIP_DURATION); 
                return;
            }

            // --- 3. ACTIVE CONTINUOUS FLIP ---
            
            // Start the next flip (e.g., 180 -> 360 or 360 -> 540)
            rotationY = nextRotation; 
            cardInner.style.transform = `rotateY(${rotationY}deg)`;

            // At the halfway point, swap content in the HIDDEN face
            setTimeout(() => {
                if (isFaceAVisible) {
                    // Face A was visible. Flip is going to B. Update B with Qn+1.
                    drawNextQuestion(false); // Set Q B
                } else {
                    // Face B was visible. Flip is going to A. Update A with Qn+1.
                    drawNextQuestion(true); // Set Q A
                }
                
                // Render the newly loaded content immediately (it's currently hidden)
                renderCardContent(!isFaceAVisible); 

                // End animation state after the full flip is complete
                setTimeout(() => {
                    isAnimating = false;
                }, HALFWAY_POINT);

            }, HALFWAY_POINT);
            updateDeckStatus(); // Update status/button visibility after flip
        };

        const restartDeck = () => {
            isAnimating = true;
            gameStatus = 'start';
            questionA = null;
            questionB = null;
            rotationY = 0;
            deck = [...INITIAL_QUESTIONS];
            
            finishedState.classList.add('hidden');
            tapArea.style.opacity = '1';
            tapArea.style.transform = 'scale(1)';
            tapArea.style.pointerEvents = 'auto';
            cardInner.style.transform = `rotateY(0deg)`;

            renderCardContent(true); // Reset Face A to Title
            updateDeckStatus(); // Update status/button visibility
            
            setTimeout(() => {
                isAnimating = false;
            }, 500);
        };

        // Event Listeners
        tapArea.addEventListener('click', handleCardTap);
        restartButton.addEventListener('click', restartDeck); // Restart from finished screen
        subtleRestartButton.addEventListener('click', restartDeck); // Subtle restart button

        // Initial Setup
        window.onload = () => {
            updateDeckStatus();
            renderCardContent(true);
        }
    </script>
</body>
</html>
